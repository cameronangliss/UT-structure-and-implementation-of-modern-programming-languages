LINK
PUSHOFF -1

// string -> len
LINK
PUSHIMM 0
LOOP1:
    DUP
    PUSHOFF -1
    ADD
    PUSHIND
    ISNIL
    JUMPC DONE1
    PUSHIMM 1
    ADD
    JUMP LOOP1
DONE1:
    STOREOFF -1
    UNLINK

PUSHIMM 0
PUSHOFF -1
PUSHOFF 1
PUSHIMM 1
ADD
MALLOC

PUSHOFF 1
PUSHOFF 4
ADD
PUSHIMMCH '\0'
STOREIND

// reverse string
LINK
LOOP:
    PUSHOFF -3
    PUSHOFF -1
    ADD
    PUSHOFF -2
    PUSHOFF -4
    DUP
    ISNIL
    JUMPC DONE
    PUSHIMM 1
    SUB
    ADD
    PUSHIND
    STOREIND
    PUSHOFF -4
    PUSHIMM 1
    SUB
    STOREOFF -4
    PUSHOFF -3
    PUSHIMM 1
    ADD
    STOREOFF -3
    JUMP LOOP
DONE:
    ADDSP -3
    UNLINK
STOREOFF -1
ADDSP -3
UNLINK
